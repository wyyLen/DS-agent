# 阿里云大模型配置指南

本文档说明如何配置 DSAgent 使用阿里云通义千问大模型。

## 配置文件

已创建/更新以下配置文件：

### 1. `config/config2.yaml` - 主配置文件
- **LLM模型**: qwen-plus-2025-12-01
- **嵌入模型**: text-embedding-v4
- **API密钥**: sk-bc8357255dd94cd88c7e34841e56446f

### 2. `config/gpt-4o.yaml` - DSAgent主模型配置
用于主要的推理和规划任务

### 3. `config/gpt-4o-mini.yaml` - DSAgent辅助模型配置
用于RAG检索和其他辅助任务

## 配置说明

所有配置文件都已设置为使用阿里云DashScope API：

```yaml
llm:
  api_type: "dashscope"  # 阿里云DashScope
  api_key: "sk-bc8357255dd94cd88c7e34841e56446f"
  model: "qwen-plus-2025-12-01"  # 通义千问Plus模型
  timeout: 600
  max_token: 4096
  temperature: 0.0

embedding:
  api_type: "dashscope"
  api_key: "sk-bc8357255dd94cd88c7e34841e56446f"
  model: "text-embedding-v4"  # 阿里云嵌入模型
  embed_batch_size: 100
```

## 环境要求

确保已安装 `dashscope` 包（已包含在 requirements.txt 中）：
```bash
pip install dashscope==1.14.1
```

## 启动服务

### 后端服务 (DSAgent-main)

1. 安装依赖：
```bash
cd dsagent-main
pip install -r requirements.txt
```

2. 启动API服务：
```bash
cd examples/ds_agent/agent_service
python api_service_provider.py
```

默认端口：8000

### 前端服务 (DSassistant)

1. 确保后端服务已启动

2. 启动前端界面：
```bash
cd DSassistant
python main.py
```

默认访问地址：http://localhost:7860

## 配置验证

配置文件加载优先级：
1. `config/gpt-4o.yaml` 和 `config/gpt-4o-mini.yaml` - 用于DS Agent特定任务
2. `config/config2.yaml` - 默认全局配置

所有文件都已配置为使用阿里云通义千问模型。

## 注意事项

1. **API密钥安全**：生产环境中应通过环境变量设置API密钥
2. **模型可用性**：确认您的阿里云账户已开通对应模型的访问权限
3. **配额限制**：注意API调用的配额和速率限制
4. **网络连接**：确保服务器可以访问阿里云API服务

## 常见问题

### Q: 如何更换不同的通义千问模型？
A: 修改配置文件中的 `model` 字段，例如：
- `qwen-max` - 更强大的模型
- `qwen-turbo` - 更快速的模型
- `qwen-plus` - 平衡性能的模型

### Q: 如何使用不同的嵌入模型？
A: 修改 `embedding.model` 字段，阿里云支持：
- `text-embedding-v1`
- `text-embedding-v2`
- `text-embedding-v3`
- `text-embedding-v4` (推荐)

### Q: 配置不生效怎么办？
A: 
1. 检查配置文件语法是否正确（YAML格式）
2. 确认API密钥有效
3. 重启后端和前端服务
4. 查看日志输出获取详细错误信息

## 技术支持

- DSAgent项目: https://github.com/BiqiangWang/DSassistant
- 阿里云DashScope文档: https://help.aliyun.com/zh/dashscope/
